<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ù„Ø§Ù†Ú†Ø±">
  <title>Ù„Ø§Ù†Ú†Ø±</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root { --bg1: #0d0d1a; --text: #ffffff; --muted: rgba(255,255,255,0.45); }

    html, body {
      height: 100%; background: var(--bg1);
      font-family: 'Vazirmatn', sans-serif; color: var(--text);
      overflow: hidden; -webkit-tap-highlight-color: transparent; user-select: none;
    }
    body {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      min-height: 100vh; min-height: -webkit-fill-available;
      padding: env(safe-area-inset-top,20px) 20px env(safe-area-inset-bottom,20px);
    }

    .bg {
      position: fixed; inset: 0; z-index: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(99,102,241,0.18) 0%, transparent 60%),
        radial-gradient(ellipse at 80% 80%, rgba(236,72,153,0.15) 0%, transparent 60%),
        linear-gradient(160deg, #0d0d1a 0%, #111128 100%);
    }

    .particles { position:fixed;inset:0;z-index:0;pointer-events:none; }
    .particle  { position:absolute;border-radius:50%;background:rgba(255,255,255,0.15);animation:float linear infinite; }
    @keyframes float {
      0%{transform:translateY(100vh) scale(0);opacity:0}
      10%{opacity:1} 90%{opacity:.5}
      100%{transform:translateY(-10vh) scale(1);opacity:0}
    }

    .container {
      position:relative;z-index:1;width:100%;max-width:400px;
      display:flex;flex-direction:column;align-items:center;gap:14px;
    }

    .clock {
      font-size:62px;font-weight:900;line-height:1;
      background:linear-gradient(135deg,#fff 0%,rgba(255,255,255,.6) 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-3px;
    }
    .date { font-size:13px;color:var(--muted);margin-top:4px;text-align:center; }

    @keyframes fadeUp {
      from{opacity:0;transform:translateY(22px) scale(.95)}
      to  {opacity:1;transform:translateY(0)    scale(1)}
    }

    /* â”€â”€ APP GRID â”€â”€ */
    .grid { display:grid;grid-template-columns:1fr 1fr;gap:12px;width:100%; }

    .app-btn { border:none;background:none;cursor:pointer;padding:0;animation:fadeUp .7s cubic-bezier(.16,1,.3,1) both; }
    .app-btn:nth-child(1){animation-delay:.05s}
    .app-btn:nth-child(2){animation-delay:.12s}
    .app-btn:nth-child(3){animation-delay:.19s}
    .app-btn:nth-child(4){animation-delay:.26s}

    .app-inner {
      position:relative;border-radius:22px;padding:20px 14px 14px;
      display:flex;flex-direction:column;align-items:center;gap:8px;
      transition:transform .12s cubic-bezier(.34,1.56,.64,1);
    }
    .app-btn:active .app-inner,
    .app-btn.triggered .app-inner { transform:scale(.92) rotateX(6deg); }
    .app-inner::before {
      content:'';position:absolute;inset:0;border-radius:22px;
      background:linear-gradient(135deg,rgba(255,255,255,.07) 0%,transparent 50%);pointer-events:none;
    }

    .wa  .app-inner { background:linear-gradient(145deg,#1a3a2a,#0d2018);border:1px solid rgba(37,211,102,.25);box-shadow:0 14px 44px rgba(37,211,102,.17),inset 0 1px 0 rgba(37,211,102,.17); }
    .cam .app-inner { background:linear-gradient(145deg,#1a1a2e,#0d0d1f);border:1px solid rgba(139,92,246,.25);box-shadow:0 14px 44px rgba(139,92,246,.17),inset 0 1px 0 rgba(139,92,246,.17); }
    .eml .app-inner { background:linear-gradient(145deg,#1a2535,#0d1520);border:1px solid rgba(59,130,246,.25); box-shadow:0 14px 44px rgba(59,130,246,.17), inset 0 1px 0 rgba(59,130,246,.17); }
    .ins .app-inner { background:linear-gradient(145deg,#2a1a1a,#1a0d0d);border:1px solid rgba(236,72,153,.25);box-shadow:0 14px 44px rgba(236,72,153,.17),inset 0 1px 0 rgba(236,72,153,.17); }

    .app-btn.triggered.wa  .app-inner { box-shadow:0 0 0 3px rgba(37,211,102,.85); }
    .app-btn.triggered.cam .app-inner { box-shadow:0 0 0 3px rgba(139,92,246,.85); }
    .app-btn.triggered.eml .app-inner { box-shadow:0 0 0 3px rgba(59,130,246,.85);  }
    .app-btn.triggered.ins .app-inner { box-shadow:0 0 0 3px rgba(236,72,153,.85); }

    .icon-wrap { width:54px;height:54px;border-radius:15px;display:flex;align-items:center;justify-content:center; }
    .wa  .icon-wrap { background:linear-gradient(135deg,#25d366,#128c3c);box-shadow:0 5px 18px rgba(37,211,102,.5); }
    .cam .icon-wrap { background:linear-gradient(135deg,#a78bfa,#7c3aed);box-shadow:0 5px 18px rgba(139,92,246,.5); }
    .eml .icon-wrap { background:linear-gradient(135deg,#60a5fa,#2563eb);box-shadow:0 5px 18px rgba(59,130,246,.5);  }
    .ins .icon-wrap { background:linear-gradient(135deg,#f9a8d4,#ec4899,#be185d);box-shadow:0 5px 18px rgba(236,72,153,.5); }
    .icon-wrap svg { width:28px;height:28px;fill:white;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3)); }

    .app-label    { font-size:14px;font-weight:600;color:rgba(255,255,255,.9); }
    .app-sublabel { font-size:11px;color:var(--muted);margin-top:-4px; }

    /* â”€â”€ MIC CARD â”€â”€ */
    .mic-card {
      width:100%;border:none;cursor:pointer;padding:0;
      border-radius:20px;background:none;display:block;
      animation:fadeUp .7s .32s cubic-bezier(.16,1,.3,1) both;
      -webkit-tap-highlight-color:transparent;
    }
    .mic-inner {
      position:relative;border-radius:20px;padding:16px 18px;
      display:flex;align-items:center;gap:15px;overflow:hidden;
      transition:transform .12s, background .3s, border-color .3s, box-shadow .3s;
      background:linear-gradient(145deg,#1c1c2e,#13131f);
      border:2px solid rgba(255,255,255,.07);
      box-shadow:0 8px 26px rgba(0,0,0,.32),inset 0 1px 0 rgba(255,255,255,.04);
    }
    .mic-card:active .mic-inner { transform:scale(.97); }
    .mic-card.on .mic-inner {
      background:linear-gradient(145deg,#2d0808,#1a0505);
      border-color:rgba(239,68,68,.55);
      box-shadow:0 8px 26px rgba(239,68,68,.28),0 0 36px rgba(239,68,68,.07),inset 0 1px 0 rgba(255,100,100,.1);
    }

    .mic-circle {
      width:52px;height:52px;border-radius:50%;flex-shrink:0;
      display:flex;align-items:center;justify-content:center;position:relative;
      background:linear-gradient(135deg,#374151,#1f2937);
      box-shadow:0 4px 12px rgba(0,0,0,.38);
      transition:background .3s,box-shadow .3s;
    }
    .mic-card.on .mic-circle {
      background:linear-gradient(135deg,#f87171,#dc2626);
      box-shadow:0 5px 16px rgba(239,68,68,.58);
      animation:micP 1.1s ease-in-out infinite;
    }
    @keyframes micP {
      0%,100%{box-shadow:0 5px 16px rgba(239,68,68,.58),0 0 0 0 rgba(239,68,68,.38)}
      50%    {box-shadow:0 5px 16px rgba(239,68,68,.58),0 0 0 11px rgba(239,68,68,0)}
    }
    .mic-circle svg { width:23px;height:23px;fill:white;position:relative;z-index:1; }

    /* Ù…ÙˆØ¬ ØµØ¯Ø§ */
    .bars { display:flex;align-items:center;gap:2.5px;position:absolute;right:-5px;top:50%;transform:translateY(-50%);opacity:0;transition:opacity .3s; }
    .mic-card.on .bars { opacity:1; }
    .bar { width:3px;border-radius:2px;background:rgba(239,68,68,.78);animation:barA .72s ease-in-out infinite; }
    .bar:nth-child(1){height:7px; animation-delay:0s}
    .bar:nth-child(2){height:13px;animation-delay:.11s}
    .bar:nth-child(3){height:19px;animation-delay:.22s}
    .bar:nth-child(4){height:13px;animation-delay:.33s}
    .bar:nth-child(5){height:7px; animation-delay:.44s}
    @keyframes barA{0%,100%{transform:scaleY(.3);opacity:.4}50%{transform:scaleY(1);opacity:1}}

    .mic-texts { flex:1;text-align:right; }
    .mic-title { display:block;font-size:15px;font-weight:700;color:rgba(255,255,255,.52);transition:color .3s; }
    .mic-card.on .mic-title { color:#fca5a5; }
    .mic-sub   { display:block;font-size:12px;margin-top:3px;color:rgba(255,255,255,.26);transition:color .3s; }
    .mic-card.on .mic-sub { color:rgba(252,165,165,.62); }
    .mic-heard { display:none;font-size:12px;margin-top:5px;color:#fbbf24;font-style:italic; }
    .mic-card.on .mic-heard { display:block; }

    /* Ø¨Ø¬ ON/OFF */
    .mic-badge {
      position:absolute;top:11px;left:13px;
      font-size:10px;font-weight:800;letter-spacing:.1em;
      padding:3px 8px;border-radius:100px;
      background:rgba(255,255,255,.05);color:rgba(255,255,255,.26);
      border:1px solid rgba(255,255,255,.08);transition:all .3s;
    }
    .mic-card.on .mic-badge { background:rgba(239,68,68,.2);color:#f87171;border-color:rgba(239,68,68,.38); }

    /* Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª */
    .status-bar {
      width:100%;border-radius:13px;padding:11px 15px;
      display:flex;align-items:center;gap:9px;min-height:42px;
      background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.07);
      transition:background .3s,border-color .3s;
      animation:fadeUp .7s .39s both;
    }
    .status-bar.active  { background:rgba(99,102,241,.08);border-color:rgba(99,102,241,.26); }
    .status-bar.success { background:rgba(34,197,94,.08); border-color:rgba(34,197,94,.26); }
    .status-dot { width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,.17);flex-shrink:0;transition:background .3s; }
    .status-bar.active  .status-dot { background:#6366f1;animation:blink .7s infinite; }
    .status-bar.success .status-dot { background:#22c55e; }
    @keyframes blink{0%,100%{opacity:1}50%{opacity:.12}}
    .status-txt { font-size:13px;color:var(--muted);flex:1; }
    .status-bar.active  .status-txt { color:rgba(255,255,255,.83); }
    .status-bar.success .status-txt { color:#4ade80; }

    /* Ø¯Ú©Ù…Ù‡ Ø®Ø±ÙˆØ¬ */
    .exit-btn {
      width:100%;border:none;cursor:pointer;padding:0;border-radius:18px;background:none;
      animation:fadeUp .7s .46s both;
    }
    .exit-inner {
      display:flex;align-items:center;gap:13px;padding:15px 18px;
      background:linear-gradient(145deg,#2a1515,#1a0a0a);
      border:1px solid rgba(239,68,68,.2);border-radius:18px;
      box-shadow:0 10px 30px rgba(239,68,68,.12),inset 0 1px 0 rgba(239,68,68,.1);
      transition:transform .12s,box-shadow .15s;
    }
    .exit-btn:active .exit-inner { transform:scale(.97);box-shadow:0 4px 10px rgba(239,68,68,.13); }
    .exit-icon-wrap { width:38px;height:38px;border-radius:11px;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#f87171,#dc2626);box-shadow:0 4px 14px rgba(239,68,68,.48); }
    .exit-icon-wrap svg { width:19px;height:19px;fill:white; }
    .exit-lbl { display:block;font-size:15px;font-weight:700;color:rgba(255,255,255,.86);text-align:right; }
    .exit-sub { display:block;font-size:11px;color:var(--muted); }

    /* Overlay */
    .overlay { position:fixed;inset:0;z-index:50;background:rgba(0,0,0,.75);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s; }
    .overlay.show { opacity:1;pointer-events:all; }
    .overlay-box { background:#1a1a2e;border:1px solid rgba(255,255,255,.1);border-radius:22px;padding:28px 24px;text-align:center;max-width:285px;width:90%;transform:scale(.9);transition:transform .3s cubic-bezier(.34,1.56,.64,1); }
    .overlay.show .overlay-box { transform:scale(1); }
    .ov-icon{font-size:42px;margin-bottom:13px}
    .ov-title{font-size:18px;font-weight:700;margin-bottom:7px}
    .ov-desc{font-size:13px;color:var(--muted);margin-bottom:20px}
    .ov-btns{display:flex;gap:10px}
    .ov-btns button{flex:1;padding:12px;border-radius:12px;border:none;font-family:'Vazirmatn',sans-serif;font-size:14px;font-weight:600;cursor:pointer}
    .btn-cancel{background:rgba(255,255,255,.08);color:var(--text)}
    .btn-exit{background:linear-gradient(135deg,#f87171,#dc2626);color:white}

    /* Toast */
    .toast {
      position:fixed;bottom:26px;left:50%;
      transform:translateX(-50%) translateY(14px);
      background:rgba(12,12,24,.93);backdrop-filter:blur(14px);
      border:1px solid rgba(255,255,255,.12);border-radius:100px;
      padding:10px 20px;font-size:13px;color:white;
      opacity:0;transition:all .3s cubic-bezier(.34,1.56,.64,1);z-index:100;white-space:nowrap;
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  </style>
</head>
<body>

<div class="bg"></div>
<div class="particles" id="particles"></div>

<div class="container">

  <div>
    <div class="clock" id="clock">--:--</div>
    <div class="date"  id="date"></div>
  </div>

  <div class="grid">
    <button class="app-btn wa"  id="btn-whatsapp"  onclick="openApp('whatsapp',this)">
      <div class="app-inner">
        <div class="icon-wrap"><svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></div>
        <span class="app-label">ÙˆØ§ØªØ³Ø§Ù¾</span><span class="app-sublabel">WhatsApp</span>
      </div>
    </button>

    <button class="app-btn cam" id="btn-camera"    onclick="openApp('camera',this)">
      <div class="app-inner">
        <div class="icon-wrap"><svg viewBox="0 0 24 24"><path d="M12 15.2a3.2 3.2 0 100-6.4 3.2 3.2 0 000 6.4z"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg></div>
        <span class="app-label">Ø¯ÙˆØ±Ø¨ÛŒÙ†</span><span class="app-sublabel">Camera</span>
      </div>
    </button>

    <button class="app-btn eml" id="btn-email"     onclick="openApp('email',this)">
      <div class="app-inner">
        <div class="icon-wrap"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></div>
        <span class="app-label">Ø§ÛŒÙ…ÛŒÙ„</span><span class="app-sublabel">Mail</span>
      </div>
    </button>

    <button class="app-btn ins" id="btn-instagram" onclick="openApp('instagram',this)">
      <div class="app-inner">
        <div class="icon-wrap"><svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg></div>
        <span class="app-label">Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</span><span class="app-sublabel">Instagram</span>
      </div>
    </button>
  </div>

  <!-- ===== MIC CARD ===== -->
  <button class="mic-card" id="micCard" onclick="toggleMic()">
    <div class="mic-inner">
      <div class="mic-badge" id="micBadge">OFF</div>
      <div class="mic-circle">
        <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
        <div class="bars">
          <div class="bar"></div><div class="bar"></div><div class="bar"></div>
          <div class="bar"></div><div class="bar"></div>
        </div>
      </div>
      <div class="mic-texts">
        <span class="mic-title" id="micTitle">Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø®Ø§Ù…ÙˆØ´Ù‡</span>
        <span class="mic-sub"   id="micSub">Ù„Ù…Ø³ Ú©Ù† ØªØ§ Ø±ÙˆØ´Ù† Ø¨Ø´Ù‡</span>
        <span class="mic-heard" id="micHeard">ğŸ¤ Ù…Ù†ØªØ¸Ø± Ø¯Ø³ØªÙˆØ±...</span>
      </div>
    </div>
  </button>

  <div class="status-bar" id="statusBar">
    <div class="status-dot"></div>
    <span class="status-txt" id="statusTxt">Ø¨Ú¯Ùˆ: ÙˆØ§ØªØ³Ø§Ù¾ØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†ØŒ Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</span>
  </div>

  <button class="exit-btn" onclick="showExit()">
    <div class="exit-inner">
      <div class="exit-icon-wrap"><svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg></div>
      <div><span class="exit-lbl">Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡</span><span class="exit-sub">Ø¨Ø³ØªÙ† Ù„Ø§Ù†Ú†Ø±</span></div>
    </div>
  </button>

</div>

<div class="overlay" id="exitOverlay">
  <div class="overlay-box">
    <div class="ov-icon">ğŸ‘‹</div>
    <div class="ov-title">Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡</div>
    <div class="ov-desc">Ù…Ø·Ù…Ø¦Ù†ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø§Ø² Ù„Ø§Ù†Ú†Ø± Ø®Ø§Ø±Ø¬ Ø¨Ø´ÛŒØŸ</div>
    <div class="ov-btns">
      <button class="btn-cancel" onclick="hideExit()">Ø§Ù†ØµØ±Ø§Ù</button>
      <button class="btn-exit"   onclick="doExit()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* â”€â”€ Ø³Ø§Ø¹Øª â”€â”€ */
function tick(){
  const n=new Date(),hh=String(n.getHours()).padStart(2,'0'),mm=String(n.getMinutes()).padStart(2,'0');
  document.getElementById('clock').textContent=hh+':'+mm;
  const D=['ÛŒÚ©Ø´Ù†Ø¨Ù‡','Ø¯ÙˆØ´Ù†Ø¨Ù‡','Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡','Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡','Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡','Ø¬Ù…Ø¹Ù‡','Ø´Ù†Ø¨Ù‡'];
  const M=['Ú˜Ø§Ù†ÙˆÛŒÙ‡','ÙÙˆØ±ÛŒÙ‡','Ù…Ø§Ø±Ø³','Ø¢ÙˆØ±ÛŒÙ„','Ù…Ù‡','Ú˜ÙˆØ¦Ù†','Ø¬ÙˆÙ„Ø§ÛŒ','Ø§ÙˆØª','Ø³Ù¾ØªØ§Ù…Ø¨Ø±','Ø§Ú©ØªØ¨Ø±','Ù†ÙˆØ§Ù…Ø¨Ø±','Ø¯Ø³Ø§Ù…Ø¨Ø±'];
  document.getElementById('date').textContent=D[n.getDay()]+'ØŒ '+n.getDate()+' '+M[n.getMonth()];
}
tick();setInterval(tick,1000);

/* â”€â”€ Ø°Ø±Ø§Øª â”€â”€ */
(function(){
  const pc=document.getElementById('particles');
  for(let i=0;i<14;i++){
    const p=document.createElement('div');p.className='particle';
    const s=Math.random()*4+2;
    p.style.cssText=`width:${s}px;height:${s}px;left:${Math.random()*100}%;animation-duration:${Math.random()*14+9}s;animation-delay:${Math.random()*14}s;opacity:${(Math.random()*.22+.04).toFixed(2)}`;
    pc.appendChild(p);
  }
})();

/* â”€â”€ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø§Ù¾ â”€â”€ */
const NAMES={whatsapp:'ÙˆØ§ØªØ³Ø§Ù¾',camera:'Ø¯ÙˆØ±Ø¨ÛŒÙ†',email:'Ø§ÛŒÙ…ÛŒÙ„',instagram:'Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…'};

function openApp(id,btn){
  if(btn){btn.classList.add('triggered');setTimeout(()=>btn.classList.remove('triggered'),480);}
  showToast('Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† '+NAMES[id]+' ...');
  if(id==='camera'){
    const inp=document.createElement('input');
    inp.type='file';inp.accept='image/*,video/*';inp.capture='environment';inp.style.display='none';
    document.body.appendChild(inp);inp.click();setTimeout(()=>inp.remove(),2000);
  } else {
    const urls={whatsapp:'whatsapp://',email:'mailto:',instagram:'instagram://'};
    window.location.href=urls[id];
  }
}

/* â”€â”€ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† â”€â”€ */
let SRec=null, micOn=false, micRestartT=null;

const KWORDS={
  whatsapp:['ÙˆØ§ØªØ³Ø§Ù¾','ÙˆØ§ØªØ³','ÙˆØ§ØªØ²','whatsapp','ÙˆØ§Øª'],
  camera:  ['Ø¯ÙˆØ±Ø¨ÛŒÙ†','Ú©Ù…Ø±Ø§','Ø¹Ú©Ø³','camera','ÙÛŒÙ„Ù…'],
  email:   ['Ø§ÛŒÙ…ÛŒÙ„','Ù…ÛŒÙ„','email','mail','Ù¾Ø³Øª'],
  instagram:['Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…','Ø§ÛŒÙ†Ø³ØªØ§','insta','instagram','Ú¯Ø±Ø§Ù…']
};

/* â† Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² onclick ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒØ´Ù‡ */
function toggleMic(){
  if(!micOn){ micStart(); }
  else       { micStop();  }
}

function micStart(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){
    setStatus('âŒ Ø§Ø² Safari Ø±ÙˆÛŒ iPhone Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†','');
    showToast('âŒ Safari Ù„Ø§Ø²Ù…Ù‡');
    return;
  }

  /* Ù‚Ø¨Ù„ÛŒ Ø±Ùˆ Ù†Ø§Ø¨ÙˆØ¯ Ú©Ù† */
  if(SRec){try{SRec.abort();}catch(e){}SRec=null;}
  clearTimeout(micRestartT);

  SRec=new SR();
  SRec.lang='fa-IR';
  SRec.continuous=false;      /* iOS Ø¨Ø§ false Ø¨Ù‡ØªØ± Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ */
  SRec.interimResults=true;
  SRec.maxAlternatives=3;

  SRec.onstart=function(){
    micOn=true;
    setMicUI(true);
    setStatus('ğŸ¤ Ø¨Ú¯Ùˆ Ø§Ø³Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ùˆ...','active');
  };

  SRec.onresult=function(e){
    let txt='';
    for(let i=e.resultIndex;i<e.results.length;i++) txt+=e.results[i][0].transcript;
    txt=txt.toLowerCase().trim();
    document.getElementById('micHeard').textContent='ğŸ¤ '+txt;
    setStatus('Ø´Ù†ÛŒØ¯Ù…: '+txt,'active');
    if(e.results[e.results.length-1].isFinal) micProcess(txt);
  };

  SRec.onerror=function(ev){
    console.log('[mic error]',ev.error);
    if(ev.error==='not-allowed'||ev.error==='service-not-allowed'){
      micOn=false;setMicUI(false);
      setStatus('â›” Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±Ø¯ Ø´Ø¯','');
      showToast('âš™ï¸ Settings â†’ Safari â†’ Microphone â†’ Allow');
    }
    /* no-speech: onend Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø² Ø®ÙˆØ¯Ú©Ø§Ø± Ù…ÛŒØ´Ù‡ */
  };

  SRec.onend=function(){
    if(micOn){
      /* Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ§ Ú©Ø§Ø±Ø¨Ø± Ø®Ø§Ù…ÙˆØ´ Ù†Ú©Ø±Ø¯Ù‡ */
      micRestartT=setTimeout(function(){
        if(micOn&&SRec){
          try{SRec.start();}
          catch(e){ micOn=false;setMicUI(false); }
        }
      },350);
    } else {
      setMicUI(false);
    }
  };

  try{ SRec.start(); }
  catch(e){
    console.log('[mic start err]',e);
    setStatus('Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ â€” Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù„Ù…Ø³ Ú©Ù†','');
    micOn=false;setMicUI(false);
  }
}

function micStop(){
  micOn=false;
  clearTimeout(micRestartT);
  if(SRec){try{SRec.stop();}catch(e){}try{SRec.abort();}catch(e){}SRec=null;}
  setMicUI(false);
  setStatus('Ø¨Ú¯Ùˆ: ÙˆØ§ØªØ³Ø§Ù¾ØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†ØŒ Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…','');
}

function micProcess(txt){
  for(const[id,ws]of Object.entries(KWORDS)){
    for(const w of ws){
      if(txt.includes(w)){
        setStatus('âœ“ '+NAMES[id]+' Ø´Ù†Ø§Ø®ØªÙ‡ Ø´Ø¯!','success');
        openApp(id,document.getElementById('btn-'+id));
        setTimeout(function(){ if(micOn)setStatus('ğŸ¤ Ø¨Ú¯Ùˆ Ø§Ø³Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø¹Ø¯ÛŒ...','active'); },2200);
        return;
      }
    }
  }
  setStatus('Ù†Ø´Ù†Ø§Ø®ØªÙ…! Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ú¯Ùˆ: ÙˆØ§ØªØ³Ø§Ù¾ØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†ØŒ Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…','');
}

function setMicUI(on){
  const card=document.getElementById('micCard');
  const badge=document.getElementById('micBadge');
  const title=document.getElementById('micTitle');
  const sub  =document.getElementById('micSub');
  if(on){
    card.classList.add('on');
    badge.textContent='ON';
    title.textContent='Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø±ÙˆØ´Ù†Ù‡ ğŸ”´';
    sub.textContent  ='Ø¯Ø§Ø±Ù‡ Ú¯ÙˆØ´ Ù…ÛŒØ¯Ù‡ â€” Ù„Ù…Ø³ Ú©Ù† ØªØ§ Ø®Ø§Ù…ÙˆØ´ Ø¨Ø´Ù‡';
  } else {
    card.classList.remove('on');
    badge.textContent='OFF';
    title.textContent='Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø®Ø§Ù…ÙˆØ´Ù‡';
    sub.textContent  ='Ù„Ù…Ø³ Ú©Ù† ØªØ§ Ø±ÙˆØ´Ù† Ø¨Ø´Ù‡';
    document.getElementById('micHeard').textContent='ğŸ¤ Ù…Ù†ØªØ¸Ø± Ø¯Ø³ØªÙˆØ±...';
  }
}

function setStatus(txt,type){
  document.getElementById('statusTxt').textContent=txt;
  document.getElementById('statusBar').className='status-bar'+(type?' '+type:'');
}

/* â”€â”€ Ø®Ø±ÙˆØ¬ â”€â”€ */
function showExit(){ document.getElementById('exitOverlay').classList.add('show'); }
function hideExit(){ document.getElementById('exitOverlay').classList.remove('show'); }
function doExit()  { window.close();setTimeout(()=>{window.location.href='about:blank';},300); }

/* â”€â”€ Toast â”€â”€ */
let _toastT;
function showToast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('show');
  clearTimeout(_toastT);_toastT=setTimeout(()=>el.classList.remove('show'),2600);
}
</script>
</body>
</html>
